
{# =========================================================
   Template: register.html
   Purpose: Customer account registration form.
            Collects personal details (name, email, password), passport number,
            birth date (not in the future), and one or more phone numbers.
   ========================================================= #}
{# templates/register.html #}
{% extends "base.html" %}

{% block title %}Create account{% endblock %}

{% block content %}
<div class="auth-wrapper">
    <div class="auth-card">
        <h1 class="auth-title">Create account</h1>
        <p class="auth-subtitle">
            Register as a new customer in the FLYTAU system.
        </p>

        <form class="auth-form" method="post" action="{{ url_for('auth.register') }}">
            {% if csrf_token is defined %}
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {% endif %}

            <div class="form-row">
                <label for="first_name">First name<span class="required">*</span></label>
                <input id="first_name"
                       name="first_name"
                       type="text"
                       placeholder="First name"
                       value="{{ request.form.get('first_name','') }}"
                       required>
            </div>

            <div class="form-row">
                <label for="last_name">Last name<span class="required">*</span></label>
                <input id="last_name"
                       name="last_name"
                       type="text"
                       placeholder="Last name"
                       value="{{ request.form.get('last_name','') }}"
                       required>
            </div>

            <div class="form-row">
                <label for="email">Email<span class="required">*</span></label>
                <input id="email"
                       name="email"
                       type="email"
                       placeholder="name@example.com"
                       value="{{ request.form.get('email') or prefill_email or '' }}"
                       required>
            </div>

            <div class="form-row">
                <label for="password">Password<span class="required">*</span></label>
                <input id="password"
                       name="password"
                       type="password"
                       placeholder="Choose a password"
                       required>
            </div>

            <div class="form-row">
                <label for="confirm">Confirm password<span class="required">*</span></label>
                <input id="confirm"
                       name="confirm"
                       type="password"
                       placeholder="Repeat password"
                       required>
            </div>

            <hr class="form-divider">

            <div class="form-row">
                <label for="passport_no">Passport number<span class="required">*</span></label>
                <input id="passport_no"
                       name="passport_no"
                       type="text"
                       placeholder="Passport number (8 digits)"
                       value="{{ request.form.get('passport_no','') }}"
                       required>
            </div>

            <div class="form-row datetime-wrapper">
                <label for="birth_date">Birth date<span class="required">*</span></label>
                <input id="birth_date"
                       name="birth_date"
                       type="date"
                       max="{{ today_str }}"
                       value="{{ request.form.get('birth_date','') }}">
                <div class="field-hint">
                    Select your date of birth (not in the future).
                </div>
            </div>

            <hr class="form-divider">

            {# NEW: unlimited phone inputs (REQUIRED: at least one) #}
            {% set phones_prefill = request.form.getlist('phones') %}
            <div class="form-row">
                <label style="display:flex; justify-content:space-between; align-items:center;">
                    Phone numbers<span class="required">*</span>
                    <button type="button" class="btn-secondary" style="padding:6px 10px;"
                            onclick="addRegPhoneField('')">
                        + Add phone
                    </button>
                </label>

                <div id="reg-phones">
                    {% if phones_prefill and phones_prefill|length > 0 %}
                        {% for p in phones_prefill %}
                            <div class="phone-row" style="display:flex; gap:8px; margin-bottom:8px;">
                                <input type="tel"
                                       name="phones"
                                       placeholder="Phone number"
                                       value="{{ p }}"
                                       style="flex:1; background-color:#152347; color:#ffffff; border:1px solid #ccc;">
                                <button type="button" class="btn-secondary" style="padding:6px 10px;"
                                        onclick="this.parentElement.remove();">
                                    Remove
                                </button>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="phone-row" style="display:flex; gap:8px; margin-bottom:8px;">
                            <input type="tel"
                                   name="phones"
                                   placeholder="Phone number"
                                   value=""
                                   style="flex:1; background-color:#152347; color:#ffffff; border:1px solid #ccc;">
                            <button type="button" class="btn-secondary" style="padding:6px 10px;"
                                    onclick="this.parentElement.remove();">
                                Remove
                            </button>
                        </div>
                    {% endif %}
                </div>

                <div class="field-hint" style="margin-top:6px;">
                    Please enter at least one phone number (you may add more).
                </div>
            </div>

            <div class="form-row form-actions">
                <button type="submit" class="btn-primary auth-submit">
                    Create account
                </button>
            </div>

            <div class="form-row form-hint">
                <span>
                    Already have an account?
                    <a href="{{ url_for('auth.login') }}">Sign in</a>
                </span>
            </div>
        </form>
    </div>
</div>
<!-- Adds/removes dynamic phone number input fields during customer registration. -->
<script>
function addRegPhoneField(value) {
    const container = document.getElementById('reg-phones');
    const row = document.createElement('div');
    row.className = 'phone-row';
    row.style.cssText = "display:flex; gap:8px; margin-bottom:8px;";

    row.innerHTML = `
        <input type="tel"
               name="phones"
               placeholder="Phone number"
               value="${value || ''}"
               style="flex:1; background-color:#152347; color:#ffffff; border:1px solid #ccc;">
        <button type="button" class="btn-secondary" style="padding:6px 10px;"
                onclick="this.parentElement.remove();">
            Remove
        </button>
    `;
    container.appendChild(row);
}
</script>
{% endblock %}
